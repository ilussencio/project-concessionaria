"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const sourcemap_segment_1 = require("./sourcemap-segment");
const binary_search_1 = require("./binary-search");
function buildBySources(decoded, memos) {
    const sources = memos.map(buildNullArray);
    for (let i = 0; i < decoded.length; i++) {
        const line = decoded[i];
        for (let j = 0; j < line.length; j++) {
            const seg = line[j];
            if (seg.length === 1)
                continue;
            const sourceIndex = seg[sourcemap_segment_1.SOURCES_INDEX];
            const sourceLine = seg[sourcemap_segment_1.SOURCE_LINE];
            const sourceColumn = seg[sourcemap_segment_1.SOURCE_COLUMN];
            const originalSource = sources[sourceIndex];
            const originalLine = (originalSource[sourceLine] || (originalSource[sourceLine] = []));
            const memo = memos[sourceIndex];
            const index = (0, binary_search_1.upperBound)(originalLine, sourceColumn, (0, binary_search_1.memoizedBinarySearch)(originalLine, sourceColumn, memo, sourceLine));
            insert(originalLine, (memo.lastIndex = index + 1), [sourceColumn, i, seg[sourcemap_segment_1.COLUMN]]);
        }
    }
    return sources;
}
exports.default = buildBySources;
function insert(array, index, value) {
    for (let i = array.length; i > index; i--) {
        array[i] = array[i - 1];
    }
    array[index] = value;
}
function buildNullArray() {
    return { __proto__: null };
}
//# sourceMappingURL=by-source.js.map