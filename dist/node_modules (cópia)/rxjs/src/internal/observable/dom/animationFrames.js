"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.animationFrames = void 0;
const Observable_1 = require("../../Observable");
const Subscription_1 = require("../../Subscription");
const performanceTimestampProvider_1 = require("../../scheduler/performanceTimestampProvider");
const animationFrameProvider_1 = require("../../scheduler/animationFrameProvider");
function animationFrames(timestampProvider) {
    return timestampProvider ? animationFramesFactory(timestampProvider) : DEFAULT_ANIMATION_FRAMES;
}
exports.animationFrames = animationFrames;
function animationFramesFactory(timestampProvider) {
    const { schedule } = animationFrameProvider_1.animationFrameProvider;
    return new Observable_1.Observable((subscriber) => {
        const subscription = new Subscription_1.Subscription();
        const provider = timestampProvider || performanceTimestampProvider_1.performanceTimestampProvider;
        const start = provider.now();
        const run = (timestamp) => {
            const now = provider.now();
            subscriber.next({
                timestamp: timestampProvider ? now : timestamp,
                elapsed: now - start,
            });
            if (!subscriber.closed) {
                subscription.add(schedule(run));
            }
        };
        subscription.add(schedule(run));
        return subscription;
    });
}
const DEFAULT_ANIMATION_FRAMES = animationFramesFactory();
//# sourceMappingURL=animationFrames.js.map